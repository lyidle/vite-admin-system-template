import{ay as P,az as R,a as Y,r as c,c as Ue,f as i,g as b,w as l,y as e,k as t,s as j,F as X,as as J,au as Q,j as y,P as W,t as re,a5 as we,av as H,E as ie,O as Ee,N as Ne,aA as he,h as F,v as te}from"./index-C-Hr_Kst.js";import{E as Ce}from"./el-card-BIvMogWJ.js";import{E as pe}from"./el-dialog-CCtCXxwB.js";import"./el-overlay-CBSgNWnW.js";import{E as xe}from"./el-pagination-DGXCxo0C.js";import{E as ae,a as ce,b as ne}from"./el-table-column-BWkg-oUL.js";import{a as me,b as fe,E as Le}from"./el-select-BXzTZbgG.js";import"./el-popover-C7y7ELvv.js";import{E as ue}from"./el-button-CCBhb979.js";import{r as $e,u as Pe,_ as Re}from"./index-DJ2rYSzD.js";import{E as _e,a as ge}from"./el-form-item-D5nk7iP3.js";import{A as De,u as Ke,E as ze}from"./useElUpload-BMw9J73g.js";/* empty css                 */import{e as le,d as qe}from"./index-DpgMtUJU.js";import{E as Se}from"./index-BcM80TaK.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./refs-i5bx7WgS.js";import"./vnode-Djh7ukKe.js";const Me=(S,O,I)=>P.get(R.MANAGER+`/admin/product/${S}/${O}?category3Id=${I}`),oe=()=>P.get(R.MANAGER+"/admin/product/baseTrademark/getTrademarkList"),ye=S=>P.get(R.MANAGER+"/admin/product/spuImageList/"+S),be=S=>P.get(R.MANAGER+"/admin/product/spuSaleAttrList/"+S),de=()=>P.get(R.MANAGER+"/admin/product/baseSaleAttrList"),Be=S=>S.id?P.post(R.MANAGER+"/admin/product/updateSpuInfo",S):P.post(R.MANAGER+"/admin/product/saveSpuInfo",S),Ge=S=>P.post(R.MANAGER+"/admin/product/saveSkuInfo",S),Te=S=>P.get(R.MANAGER+"/admin/product/findBySpuId/"+S),Fe=S=>P.delete(R.MANAGER+"/admin/product/deleteSpu/"+S),je=["src"],He=Y({name:"spuForm"}),Oe=Y({...He,emits:["changeScene"],setup(S,{expose:O,emit:I}){const E=I;function k(){E("changeScene",{change:0,flag:"stay",rejectReq:!0}),p()}const h=c([]),U=c([]),d=c([]);let D=c([]);const f=c({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),L=c(!1),K=c("");let v=c("");async function C(s){f.value=s;const a=await oe(),A=await ye(s.id),N=await be(s.id),G=await de();h.value=a.data,U.value=A.data.map(z=>({name:z.imgName,url:le(z.imgUrl)})),d.value=N.data,D.value=G.data}function r(s){K.value=s.url,L.value=!0}function m(){}const{beforeUpload:_}=Ke(),w=Ue(()=>D.value.filter(s=>d.value.every(a=>a.saleAttrName!==s.name)));function M(){const[s,a]=v.value.split(":"),A={baseSaleAttrId:s,saleAttrName:a,spuSaleAttrValueList:[]};d.value.push(A),v.value=""}const B=c();function g(s){s.flag=!0,s.saleAttrValue="",we(()=>{B.value.focus()})}function u(s){const{baseSaleAttrId:a,saleAttrValue:A}=s,N={baseSaleAttrId:a,saleAttrValueName:A};if(s.spuSaleAttrValueList.find(z=>z.saleAttrValueName==A)){H.error("属性值不能重复~");return}s.spuSaleAttrValueList.push(N),N.saleAttrValueName.trim()===""&&(H.error("属性值不能为空~"),s.spuSaleAttrValueList.splice(s.spuSaleAttrValueList.length-1,1)),s.flag=!1}async function x(){f.value.spuImageList=U.value.map(a=>({imgName:a.name,imgUrl:qe(a.response&&a.response.data||a.url)})),f.value.spuSaleAttrList=d.value,(await Be(f.value)).code===200?(H.success(f.value.id?"更新成功~":"添加成功"),E("changeScene",{change:0,flag:f.value.id?"stay":"reset"}),p()):H.error(f.value.id?"更新失败~":"添加失败")}async function n(s){p(),f.value.category3Id=s;const a=await oe(),A=await de();h.value=a.data,D.value=A.data}function p(){f.value={category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[],id:""},U.value=[],d.value=[],v.value=""}return O({initHasSpuData:C,initAddSpu:n}),(s,a)=>{const A=Se,N=_e,G=me,z=fe,$=ie,Z=ze,V=pe,q=ue,ee=ae,Ae=Le,Ve=ce,Ie=ne,ke=ge;return i(),b(ke,{"label-width":"100px"},{default:l(()=>[e(N,{label:"SPU名称"},{default:l(()=>[e(A,{placeholder:"请输入SPU名称",modelValue:t(f).spuName,"onUpdate:modelValue":a[0]||(a[0]=o=>t(f).spuName=o)},null,8,["modelValue"])]),_:1}),e(N,{label:"SPU品牌"},{default:l(()=>[e(z,{style:{width:"200px"},modelValue:t(f).tmId,"onUpdate:modelValue":a[1]||(a[1]=o=>t(f).tmId=o)},{default:l(()=>[(i(!0),j(X,null,J(t(h),o=>(i(),b(G,{value:o.id,label:o.tmName,key:o.id},null,8,["value","label"]))),128)),e(G,{value:"",label:"小米"})]),_:1},8,["modelValue"])]),_:1}),e(N,{label:"SPU描述"},{default:l(()=>[e(A,{type:"textarea",placeholder:"请输入SPU描述",modelValue:t(f).description,"onUpdate:modelValue":a[2]||(a[2]=o=>t(f).description=o)},null,8,["modelValue"])]),_:1}),e(N,{label:"SPU图标"},{default:l(()=>[e(Z,{"file-list":t(U),"onUpdate:fileList":a[3]||(a[3]=o=>Q(U)?U.value=o:null),action:t(De).fileUpload,"list-type":"picture-card","on-preview":r,"on-remove":m,"before-upload":t(_)},{default:l(()=>[e($,null,{default:l(()=>a[6]||(a[6]=[y("i",{class:"i-ep-plus"},null,-1)])),_:1})]),_:1},8,["file-list","action","before-upload"]),e(V,{modelValue:t(L),"onUpdate:modelValue":a[4]||(a[4]=o=>Q(L)?L.value=o:null),style:{overflow:"hidden"}},{default:l(()=>[y("img",{"w-full":"",src:t(le)(t(K)),alt:"Preview Image",style:{width:"100%"}},null,8,je)]),_:1},8,["modelValue"])]),_:1}),e(N,{label:"SPU销售属性"},{default:l(()=>[e(z,{style:{width:"200px"},placeholder:t(w).length?`还未选择${t(w).length}个`:"无",modelValue:t(v),"onUpdate:modelValue":a[5]||(a[5]=o=>Q(v)?v.value=o:v=o)},{default:l(()=>[(i(!0),j(X,null,J(t(w),o=>(i(),b(G,{key:o.id,label:o.name,value:`${o.id}:${o.name}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e(q,{type:"primary",style:{"margin-left":"15px"},disabled:!t(v),onClick:M},{default:l(()=>[e($,null,{default:l(()=>a[7]||(a[7]=[y("i",{class:"i-ep-plus"},null,-1)])),_:1}),a[8]||(a[8]=y("span",null,"添加属性值",-1))]),_:1},8,["disabled"]),e(Ie,{border:"",style:{width:"100%","margin-top":"15px"},data:t(d)},{default:l(()=>[e(ee,{type:"index",label:"序号",width:"80",align:"center"}),e(ee,{prop:"saleAttrName",label:"销售属性名字"}),e(ee,{label:"销售属性值"},{default:l(({row:o})=>[(i(!0),j(X,null,J(o.spuSaleAttrValueList,(T,se)=>(i(),b(Ae,{key:T.id,closable:"",style:{margin:"5px"},onClose:al=>o.spuSaleAttrValueList.splice(se,1)},{default:l(()=>[W(re(T.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),o.flag?(i(),b(A,{key:0,placeholder:"请输入属性值",size:"small",modelValue:o.saleAttrValue,"onUpdate:modelValue":T=>o.saleAttrValue=T,ref_key:"EditComponent",ref:B,onBlur:T=>u(o)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(i(),b(q,{key:1,type:"primary",size:"small",style:{margin:"5px"},onClick:T=>g(o)},{default:l(()=>[e($,null,{default:l(()=>a[9]||(a[9]=[y("i",{class:"i-ep-plus"},null,-1)])),_:1})]),_:2},1032,["onClick"]))]),_:1}),e(ee,{prop:"prop",label:"操作"},{default:l(({$index:o,row:T})=>[e(Ve,{title:`你确定要删除${T.saleAttrName}么？`,onConfirm:se=>t(d).splice(o,1)},{reference:l(()=>[e(q,{type:"danger",size:"small",style:{margin:"5px"}},{default:l(()=>[e($,null,{default:l(()=>a[10]||(a[10]=[y("i",{class:"i-ep-delete"},null,-1)])),_:1})]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),e(N,null,{default:l(()=>[e(q,{disabled:!t(d).length,type:"primary",onClick:x},{default:l(()=>a[11]||(a[11]=[W("保存")])),_:1},8,["disabled"]),e(q,{onClick:k},{default:l(()=>a[12]||(a[12]=[W("取消")])),_:1})]),_:1})]),_:1})}}}),Xe=["src"],Je=Y({name:"skuForm"}),Qe=Y({...Je,emits:["changeScene"],setup(S,{expose:O,emit:I}){const E=c([]),k=c([]),h=c([]),U=c();let d=Ee({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});async function D(C,r,m){d.category3Id=m.category3Id,d.spuId=m.id,d.tmId=m.tmId;const _=await $e(C,r,m.category3Id),w=await be(m.id);let M=await ye(m.id);E.value=_.data,k.value=w.data,h.value=M.data}function f(C){h.value.forEach(r=>r.isDefault=!1),C.isDefault=!0,U.value.clearSelection(C,!0),U.value.toggleRowSelection(C,!0),d.skuDefaultImg=C.imgUrl}const L=I;function K(){L("changeScene",{change:0,flag:"stay",rejectReq:!0})}async function v(){d.skuAttrValueList=E.value.reduce((r,m)=>{if(m.attrIdAndValueId){const[_,w]=m.attrIdAndValueId.split(":");r.push({attrId:_,valueId:w})}return r},[]),d.skuSaleAttrValueList=k.value.reduce((r,m)=>{if(m.saleIdAndValueId){const[_,w]=m.saleIdAndValueId.split(":");r.push({saleAttrId:_,saleAttrValueId:w})}return r},[]),(await Ge(d)).code===200?(H.success("添加SKU成功~"),L("changeScene",{change:0,flag:"stay",rejectReq:!0})):H.error("添加SKU失败~")}return O({initSkuData:D}),(C,r)=>{const m=Se,_=_e,w=me,M=fe,B=ge,g=ae,u=ue,x=ne;return i(),b(B,{"label-width":"80px"},{default:l(()=>[e(_,{label:"SKU名称"},{default:l(()=>[e(m,{placeholder:"SKU名称",modelValue:t(d).skuName,"onUpdate:modelValue":r[0]||(r[0]=n=>t(d).skuName=n)},null,8,["modelValue"])]),_:1}),e(_,{label:"价格(元)"},{default:l(()=>[e(m,{placeholder:"价格(元)",type:"number",modelValue:t(d).price,"onUpdate:modelValue":r[1]||(r[1]=n=>t(d).price=n)},null,8,["modelValue"])]),_:1}),e(_,{label:"重量(克)"},{default:l(()=>[e(m,{placeholder:"重量(克)",type:"number",modelValue:t(d).weight,"onUpdate:modelValue":r[2]||(r[2]=n=>t(d).weight=n)},null,8,["modelValue"])]),_:1}),e(_,{label:"SKU描述"},{default:l(()=>[e(m,{type:"textarea",placeholder:"SKU描述",modelValue:t(d).skuDesc,"onUpdate:modelValue":r[3]||(r[3]=n=>t(d).skuDesc=n)},null,8,["modelValue"])]),_:1}),e(_,{label:"平台属性"},{default:l(()=>[e(B,{inline:!0,"label-width":"80px",class:"stageAttr"},{default:l(()=>[(i(!0),j(X,null,J(t(E),n=>(i(),b(_,{style:{margin:"0 10px 10px 0"},key:n.id,label:n.attrName},{default:l(()=>[e(M,{placeholder:"请选择",style:{width:"90px"},modelValue:n.attrIdAndValueId,"onUpdate:modelValue":p=>n.attrIdAndValueId=p},{default:l(()=>[(i(!0),j(X,null,J(n.attrValueList,p=>(i(),b(w,{key:p.id,label:p.valueName,value:`${n.id}:${p.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"销售属性"},{default:l(()=>[e(B,{inline:!0},{default:l(()=>[(i(!0),j(X,null,J(t(k),n=>(i(),b(_,{key:n.id,label:n.saleAttrName},{default:l(()=>[e(M,{placeholder:"请选择",style:{width:"90px"},modelValue:n.saleIdAndValueId,"onUpdate:modelValue":p=>n.saleIdAndValueId=p},{default:l(()=>[(i(!0),j(X,null,J(n.spuSaleAttrValueList,p=>(i(),b(w,{label:p.saleAttrValueName,value:`${n.id}:${p.id}`},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"图片名称"},{default:l(()=>[e(x,{style:{width:"100%"},border:"",data:t(h),ref_key:"table",ref:U},{default:l(()=>[e(g,{type:"selection",width:"width",align:"center"}),e(g,{prop:"prop",label:"图片",width:"width"},{default:l(({row:n})=>[y("img",{src:t(le)(n.imgUrl),alt:"",style:{width:"100px"}},null,8,Xe)]),_:1}),e(g,{prop:"imgName",label:"名称",width:"width"}),e(g,{label:"操作",width:"width"},{default:l(({row:n})=>[e(u,{type:"primary",size:"small",onClick:p=>f(n),plain:n.isDefault},{default:l(()=>[W(re(n.isDefault?"默认":"设置默认"),1)]),_:2},1032,["onClick","plain"])]),_:1})]),_:1},8,["data"])]),_:1}),e(_,{label:""},{default:l(()=>[e(u,{type:"primary",onClick:v},{default:l(()=>r[4]||(r[4]=[W("保存")])),_:1}),e(u,{onClick:K},{default:l(()=>r[5]||(r[5]=[W("取消")])),_:1})]),_:1})]),_:1})}}}),We=ve(Qe,[["__scopeId","data-v-3b5be7a9"]]),Ye={class:"container"},Ze={class:"card-content"},el=["src"],ll=Y({name:"Spu"}),tl=Y({...ll,setup(S){const O=Ne(),I=c(0),E=Pe(),k=c(1),h=c(3),U=c([]),d=c(0),D=c(),f=c(),L=c([]),K=c(!1);async function v(g=1,u){if(k.value=g,!u&&E.c3Id){const x=await Me(k.value,h.value,E.c3Id);x.code===200&&(U.value=x.data.records,d.value=x.data.total)}}function C(){v()}function r(g){const{change:u,flag:x,rejectReq:n}=g;I.value=u,v(x==="stay"?k.value:1,n)}function m(){I.value=1,D.value.initAddSpu(E.c3Id)}function _(g){I.value=1,D.value.initHasSpuData(g)}function w(g){I.value=2,f.value.initSkuData(E.c1Id,E.c2Id,g)}async function M(g){const u=await Te(g.id);u.code===200&&(L.value=u.data,K.value=!0)}async function B(g){(await Fe(g.id)).code===200?(H.success("删除成功~"),await v(U.value.length>1?k.value:k.value-1)):H.error("删除失败~")}return(g,u)=>{const x=Re,n=ie,p=ue,s=ae,a=ce,A=ne,N=xe,G=pe,z=Ce,$=he("hasButton");return i(),j("div",Ye,[e(x,{scene:t(I),onEmitCategory:v},null,8,["scene"]),e(z,null,{default:l(()=>{var Z;return[F(y("div",Ze,[(Z=t(O).$state.userInfo.buttons)!=null&&Z.includes("btn.Spu.add")?(i(),b(p,{key:0,type:"primary",disabled:!t(E).c3Id,onClick:m},{default:l(()=>[e(n,null,{default:l(()=>u[3]||(u[3]=[y("i",{class:"i-ep-plus"},null,-1)])),_:1}),u[4]||(u[4]=y("span",null,"添加SPU",-1))]),_:1},8,["disabled"])):F((i(),b(p,{key:1,type:"primary"},{default:l(()=>[e(n,null,{default:l(()=>u[5]||(u[5]=[y("i",{class:"i-ep-plus"},null,-1)])),_:1}),u[6]||(u[6]=y("span",null,"添加SPU",-1))]),_:1})),[[$,"btn.Spu.add:添加SPU"]]),e(A,{border:"",style:{width:"100%"},data:t(U)},{default:l(()=>[e(s,{type:"index",label:"序号",width:"80",align:"center"}),e(s,{prop:"spuName",label:"SPU名称",width:"width"}),e(s,{prop:"description",label:"SPU描述",width:"width","show-overflow-tooltip":""}),e(s,{prop:"index",label:"操作",width:"width"},{default:l(({row:V})=>[F((i(),b(p,{type:"primary",size:"small",title:"添加SKU",onClick:q=>w(V),style:{margin:"5px"}},{default:l(()=>[e(n,null,{default:l(()=>u[7]||(u[7]=[y("i",{class:"i-ep-plus"},null,-1)])),_:1})]),_:2},1032,["onClick"])),[[$,"btn.Spu.addsku:添加SKU"]]),F((i(),b(p,{type:"success",size:"small",title:"修改SKU",onClick:q=>_(V),style:{margin:"5px"}},{default:l(()=>[e(n,null,{default:l(()=>u[8]||(u[8]=[y("i",{class:"i-ep-edit"},null,-1)])),_:1})]),_:2},1032,["onClick"])),[[$,"btn.Spu.update:修改SKU"]]),F((i(),b(p,{type:"info",size:"small",title:"查看SKU",onClick:q=>M(V),style:{margin:"5px"}},{default:l(()=>[e(n,null,{default:l(()=>u[9]||(u[9]=[y("i",{class:"i-ep-view"},null,-1)])),_:1})]),_:2},1032,["onClick"])),[[$,"btn.Spu.skus:查看SKU"]]),e(a,{title:`你确定要删除${V.spuName}么?`,onConfirm:q=>B(V)},{reference:l(()=>[F((i(),b(p,{type:"danger",size:"small",title:"删除SKU",style:{margin:"5px"}},{default:l(()=>[e(n,null,{default:l(()=>u[10]||(u[10]=[y("i",{class:"i-ep-delete"},null,-1)])),_:1})]),_:1})),[[$,"btn.Spu.delete:删除SKU"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(N,{"current-page":t(k),"onUpdate:currentPage":u[0]||(u[0]=V=>Q(k)?k.value=V:null),"page-size":t(h),"onUpdate:pageSize":u[1]||(u[1]=V=>Q(h)?h.value=V:null),"page-sizes":[3,5,10],size:"small",background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:t(d),onCurrentChange:v,onSizeChange:C},null,8,["current-page","page-size","total"])],512),[[te,t(I)===0]]),F(e(Oe,{ref_key:"Spu",ref:D,onChangeScene:r},null,512),[[te,t(I)===1]]),F(e(We,{ref_key:"Sku",ref:f,onChangeScene:r},null,512),[[te,t(I)===2]]),e(G,{title:"SKU列表",modelValue:t(K),"onUpdate:modelValue":u[2]||(u[2]=V=>Q(K)?K.value=V:null),style:{width:"80%"}},{default:l(()=>[e(A,{data:t(L),style:{width:"100%"}},{default:l(()=>[e(s,{prop:"skuName",label:"SKU名字",width:"width"}),e(s,{prop:"price",label:"SKU价格",width:"width"}),e(s,{prop:"weight",label:"SKU重量",width:"width"}),e(s,{label:"SKU图片",width:"width"},{default:l(({row:V})=>[y("img",{src:t(le)(V.skuDefaultImg),alt:"",style:{width:"100px"}},null,8,el)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]}),_:1})])}}}),Vl=ve(tl,[["__scopeId","data-v-42d2a75b"]]);export{Vl as default};

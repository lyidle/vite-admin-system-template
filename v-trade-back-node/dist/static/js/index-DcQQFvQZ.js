import{a as h,N as K,r as I,O as Q,aA as W,f as u,s as L,y as e,k as o,w as a,h as b,j as r,g as v,F as X,as as Y,P as E,t as $,v as O,a5 as U,av as y,E as Z}from"./index-C-Hr_Kst.js";import{E as tt}from"./el-card-BIvMogWJ.js";import{E as et,a as at}from"./el-form-item-D5nk7iP3.js";/* empty css                 */import{E as lt,a as nt,b as st}from"./el-table-column-BWkg-oUL.js";import"./el-popover-C7y7ELvv.js";import{E as ot}from"./el-button-CCBhb979.js";import{u as rt,r as it,a as dt,b as ut,_ as pt}from"./index-DJ2rYSzD.js";import{E as mt}from"./el-select-BXzTZbgG.js";import{E as ct}from"./index-BcM80TaK.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _t={class:"container"},vt={class:"card-content"},yt={class:"card-content"},bt=["onClick"],gt=h({name:"Attr"}),Et=h({...gt,setup(Ct){const m=rt(),T=K(),C=I([]),c=I(0),l=Q({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),N=I();async function V(){if(m.c1Id){C.value=[];const s=await it(m.c1Id,m.c2Id,m.c3Id);s.code===200&&(C.value=s.data)}}function z(){l.attrValueList.push({valueName:"",isEdit:!0}),U(()=>{N.value.focus()})}function F(){Object.assign(l,{attrName:"",attrValueList:[],categoryId:m.c3Id,categoryLevel:3,id:void 0}),c.value=1,l.categoryId=m.c3Id}function j(s){c.value=1,Object.assign(l,JSON.parse(JSON.stringify(s)))}function A(){c.value=0}async function q(s,t){const _=await dt(s);(_==null?void 0:_.code)===200?(y.success(`删除${t}属性成功~`),V()):y.error(`删除${t}属性失败~`)}async function D(){(await ut(l)).code===200?(c.value=0,y.success(l.id?"修改成功~":"添加成功~"),V()):y.error(l.id?"修改失败~":"添加失败~")}function P(s,t){if(s.valueName.trim()===""){l.attrValueList.splice(t,1),y.error("属性值不能为空~");return}if(l.attrValueList.find(i=>{if(i!==s)return i.valueName===s.valueName})){l.attrValueList.splice(t,1),y.error("属性值不能重复~");return}s.isEdit=!1}function J(s){s.isEdit=!0,U(()=>{N.value.focus()})}return(s,t)=>{const _=pt,i=Z,d=ot,f=lt,M=mt,w=nt,x=st,B=ct,R=et,G=at,H=tt,k=W("hasButton");return u(),L("div",_t,[e(_,{onEmitCategory:V,scene:o(c)},null,8,["scene"]),e(H,{class:"attr-card"},{default:a(()=>{var S;return[b(r("div",vt,[(S=o(T).$state.userInfo.buttons)!=null&&S.includes("btn.Attr.add")?(u(),v(d,{key:0,type:"primary",disabled:!o(m).c3Id,onClick:F},{default:a(()=>[e(i,null,{default:a(()=>t[1]||(t[1]=[r("i",{class:"i-ep-plus"},null,-1)])),_:1}),t[2]||(t[2]=r("span",null,"添加平台属性",-1))]),_:1},8,["disabled"])):b((u(),v(d,{key:1,type:"primary"},{default:a(()=>[e(i,null,{default:a(()=>t[3]||(t[3]=[r("i",{class:"i-ep-plus"},null,-1)])),_:1}),t[4]||(t[4]=r("span",null,"添加平台属性",-1))]),_:1})),[[k,"btn.Attr.add:添加平台属性"]]),e(x,{style:{width:"100%"},border:"",data:o(C)},{default:a(()=>[e(f,{type:"index",prop:"prop",label:"序号",width:"80",align:"center"}),e(f,{prop:"attrName",label:"属性名称",width:"width"}),e(f,{label:"属性值名称",width:"width"},{default:a(({row:n})=>[(u(!0),L(X,null,Y(n.attrValueList,p=>(u(),v(M,{key:p.attrId,style:{margin:"5px"}},{default:a(()=>[E($(p.valueName),1)]),_:2},1024))),128))]),_:1}),e(f,{prop:"prop",label:"操作",width:"width"},{default:a(({row:n})=>[b((u(),v(d,{type:"warning",size:"small",onClick:p=>j(n)},{default:a(()=>[e(i,null,{default:a(()=>t[5]||(t[5]=[r("i",{class:"i-ep-edit"},null,-1)])),_:1})]),_:2},1032,["onClick"])),[[k,"btn.Attr.update:编辑平台属性"]]),e(w,{title:`你确定要删除${n.attrName}么?`,onConfirm:p=>q(n.id,n.attrName)},{reference:a(()=>[b((u(),v(d,{type:"danger",size:"small"},{default:a(()=>[e(i,null,{default:a(()=>t[6]||(t[6]=[r("i",{class:"i-ep-delete"},null,-1)])),_:1})]),_:1})),[[k,"btn.Attr.remove:删除平台属性"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[O,o(c)===0]]),b(r("div",yt,[e(G,{inline:!0},{default:a(()=>[e(R,{label:"属性名称"},{default:a(()=>[e(B,{placeholder:"请输入属性名称",modelValue:o(l).attrName,"onUpdate:modelValue":t[0]||(t[0]=n=>o(l).attrName=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{type:"primary",disabled:!o(l).attrName,onClick:z},{default:a(()=>[e(i,null,{default:a(()=>t[7]||(t[7]=[r("i",{class:"i-ep-plus"},null,-1)])),_:1}),t[8]||(t[8]=r("span",null,"添加属性值",-1))]),_:1},8,["disabled"]),e(d,{onClick:A},{default:a(()=>t[9]||(t[9]=[E("取消")])),_:1}),e(x,{style:{width:"100%"},border:"",data:o(l).attrValueList},{default:a(()=>[e(f,{prop:"prop",label:"序号",type:"index",width:"80",align:"center"}),e(f,{prop:"prop",label:"属性值",width:"width"},{default:a(({row:n,$index:p})=>[n.isEdit?(u(),v(B,{key:0,placeholder:"请输入属性值名称",modelValue:n.valueName,"onUpdate:modelValue":g=>n.valueName=g,onBlur:g=>P(n,p),size:"small",ref_key:"EditComponent",ref:N},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(u(),L("div",{key:1,onClick:g=>J(n)},$(n.valueName),9,bt))]),_:1}),e(f,{prop:"prop",label:"操作",width:"width"},{default:a(({$index:n,row:p})=>[e(w,{title:`你确定要删除${p.valueName}么？`,onConfirm:g=>o(l).attrValueList.splice(n,1)},{reference:a(()=>[e(d,{type:"danger",size:"small"},{default:a(()=>[e(i,null,{default:a(()=>t[10]||(t[10]=[r("i",{class:"i-ep-delete"},null,-1)])),_:1})]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(d,{type:"primary",onClick:D,disabled:!(o(l).attrValueList.length>0&&o(l).attrValueList[o(l).attrValueList.length-1].valueName.trim()!=="")},{default:a(()=>t[11]||(t[11]=[E("保存")])),_:1},8,["disabled"]),e(d,{onClick:A},{default:a(()=>t[12]||(t[12]=[E("取消")])),_:1})],512),[[O,o(c)===1]])]}),_:1})])}}}),Ot=ft(Et,[["__scopeId","data-v-04e4f45e"]]);export{Ot as default};

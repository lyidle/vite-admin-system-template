import{at as Ee,f as r,s as z,j,az as L,aA as P,a as Z,r as c,c as Ne,g as b,w as t,y as e,k as l,F as X,as as J,av as W,P as Y,t as ce,a5 as Ce,aw as H,E as me,O as xe,N as $e,aB as Le,h as F,v as oe}from"./index-DpaPK14g.js";import{E as Pe}from"./el-card-jy9cJqIZ.js";import{E as _e}from"./el-dialog-CdQBEZHb.js";import"./el-overlay-Bqy0qcE3.js";import{E as De}from"./el-pagination-gWFwAzPI.js";import{E as se,b as de,a as Re}from"./el-table-column-Om27YJSB.js";import{b as fe,c as ge,E as Ke,a as Se,_ as ze}from"./edit-C5rcNmWR.js";import"./el-popover-B0UGxlQI.js";import{E as re}from"./el-button-C3BECGQo.js";import{_ as ue}from"./plus-Bqin_PZf.js";import{r as qe,u as Me,_ as Be}from"./index-BaNNlmEo.js";import{E as ve,a as ye}from"./el-form-item-Utq6rYWC.js";import{A as Ge,u as Te,E as Fe}from"./useElUpload-CYKOpwmv.js";/* empty css                 */import{e as le,d as je}from"./index-DpgMtUJU.js";import{E as be}from"./index-CKDBud7m.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./refs-DUQRGRFA.js";import"./vnode-wd0zXfV_.js";const He={viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Oe(g,x){return r(),z("svg",He,x[0]||(x[0]=[j("path",{fill:"currentColor",d:"M512 160c320 0 512 352 512 352S832 864 512 864S0 512 0 512s192-352 512-352m0 64c-225.28 0-384.128 208.064-436.8 288c52.608 79.872 211.456 288 436.8 288c225.28 0 384.128-208.064 436.8-288c-52.608-79.872-211.456-288-436.8-288m0 64a224 224 0 1 1 0 448a224 224 0 0 1 0-448m0 64a160.19 160.19 0 0 0-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160s-71.744-160-160-160"},null,-1)]))}const Xe=Ee({name:"ep-view",render:Oe}),Je=(g,x,A)=>L.get(P.MANAGER+`/admin/product/${g}/${x}?category3Id=${A}`),ie=()=>L.get(P.MANAGER+"/admin/product/baseTrademark/getTrademarkList"),Ve=g=>L.get(P.MANAGER+"/admin/product/spuImageList/"+g),ke=g=>L.get(P.MANAGER+"/admin/product/spuSaleAttrList/"+g),pe=()=>L.get(P.MANAGER+"/admin/product/baseSaleAttrList"),Qe=g=>g.id?L.post(P.MANAGER+"/admin/product/updateSpuInfo",g):L.post(P.MANAGER+"/admin/product/saveSpuInfo",g),We=g=>L.post(P.MANAGER+"/admin/product/saveSkuInfo",g),Ye=g=>L.get(P.MANAGER+"/admin/product/findBySpuId/"+g),Ze=g=>L.delete(P.MANAGER+"/admin/product/deleteSpu/"+g),et=["src"],tt=Z({name:"spuForm"}),lt=Z({...tt,emits:["changeScene"],setup(g,{expose:x,emit:A}){const U=A;function V(){U("changeScene",{change:0,flag:"stay",rejectReq:!0}),p()}const E=c([]),k=c([]),s=c([]);let D=c([]);const _=c({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),$=c(!1),R=c("");let y=c("");async function N(u){_.value=u;const a=await ie(),h=await Ve(u.id),w=await ke(u.id),B=await pe();E.value=a.data,k.value=h.data.map(K=>({name:K.imgName,url:le(K.imgUrl)})),s.value=w.data,D.value=B.data}function d(u){R.value=u.url,$.value=!0}function m(){}const{beforeUpload:f}=Te(),I=Ne(()=>D.value.filter(u=>s.value.every(a=>a.saleAttrName!==u.name)));function q(){const[u,a]=y.value.split(":"),h={baseSaleAttrId:u,saleAttrName:a,spuSaleAttrValueList:[]};s.value.push(h),y.value=""}const M=c();function S(u){u.flag=!0,u.saleAttrValue="",Ce(()=>{M.value.focus()})}function i(u){const{baseSaleAttrId:a,saleAttrValue:h}=u,w={baseSaleAttrId:a,saleAttrValueName:h};if(w.saleAttrValueName.trim()===""){H.error("属性值不能为空~");return}if(u.spuSaleAttrValueList.find(K=>K.saleAttrValueName==h)){H.error("属性值不能重复~");return}u.spuSaleAttrValueList.push(w),u.flag=!1}async function C(){_.value.spuImageList=k.value.map(a=>({imgName:a.name,imgUrl:je(a.response&&a.response.data||a.url)})),_.value.spuSaleAttrList=s.value,(await Qe(_.value)).code===200?(H.success(_.value.id?"更新成功~":"添加成功"),U("changeScene",{change:0,flag:_.value.id?"stay":"reset"}),p()):H.error(_.value.id?"更新失败~":"添加失败")}async function n(u){p(),_.value.category3Id=u;const a=await ie(),h=await pe();E.value=a.data,D.value=h.data}function p(){_.value={category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[],id:""},k.value=[],s.value=[],y.value=""}return x({initHasSpuData:N,initAddSpu:n}),(u,a)=>{const h=be,w=ve,B=fe,K=ge,te=ue,Q=me,ae=Fe,ne=_e,G=ue,T=re,v=se,ee=Ke,Ie=Se,he=de,Ue=ye;return r(),b(Ue,{"label-width":"100px"},{default:t(()=>[e(w,{label:"SPU名称"},{default:t(()=>[e(h,{placeholder:"请输入SPU名称",modelValue:l(_).spuName,"onUpdate:modelValue":a[0]||(a[0]=o=>l(_).spuName=o)},null,8,["modelValue"])]),_:1}),e(w,{label:"SPU品牌"},{default:t(()=>[e(K,{style:{width:"200px"},modelValue:l(_).tmId,"onUpdate:modelValue":a[1]||(a[1]=o=>l(_).tmId=o)},{default:t(()=>[(r(!0),z(X,null,J(l(E),o=>(r(),b(B,{value:o.id,label:o.tmName,key:o.id},null,8,["value","label"]))),128)),e(B,{value:"",label:"小米"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"SPU描述"},{default:t(()=>[e(h,{type:"textarea",placeholder:"请输入SPU描述",modelValue:l(_).description,"onUpdate:modelValue":a[2]||(a[2]=o=>l(_).description=o)},null,8,["modelValue"])]),_:1}),e(w,{label:"SPU图标"},{default:t(()=>[e(ae,{"file-list":l(k),"onUpdate:fileList":a[3]||(a[3]=o=>W(k)?k.value=o:null),action:l(Ge).fileUpload,"list-type":"picture-card","on-preview":d,"on-remove":m,"before-upload":l(f)},{default:t(()=>[e(Q,null,{default:t(()=>[e(te)]),_:1})]),_:1},8,["file-list","action","before-upload"]),e(ne,{modelValue:l($),"onUpdate:modelValue":a[4]||(a[4]=o=>W($)?$.value=o:null),style:{overflow:"hidden"}},{default:t(()=>[j("img",{"w-full":"",src:l(le)(l(R)),alt:"Preview Image",style:{width:"100%"}},null,8,et)]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"SPU销售属性"},{default:t(()=>[e(K,{style:{width:"200px"},placeholder:l(I).length?`还未选择${l(I).length}个`:"无",modelValue:l(y),"onUpdate:modelValue":a[5]||(a[5]=o=>W(y)?y.value=o:y=o)},{default:t(()=>[(r(!0),z(X,null,J(l(I),o=>(r(),b(B,{key:o.id,label:o.name,value:`${o.id}:${o.name}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e(T,{type:"primary",style:{"margin-left":"15px"},disabled:!l(y),onClick:q},{default:t(()=>[e(Q,null,{default:t(()=>[e(G)]),_:1}),a[6]||(a[6]=j("span",null,"添加属性值",-1))]),_:1},8,["disabled"]),e(he,{border:"",style:{width:"100%","margin-top":"15px"},data:l(s)},{default:t(()=>[e(v,{type:"index",label:"序号",width:"80",align:"center"}),e(v,{prop:"saleAttrName",label:"销售属性名字"}),e(v,{label:"销售属性值"},{default:t(({row:o})=>[(r(!0),z(X,null,J(o.spuSaleAttrValueList,(O,we)=>(r(),b(ee,{key:O.id,closable:"",style:{margin:"5px"},onClose:ct=>o.spuSaleAttrValueList.splice(we,1)},{default:t(()=>[Y(ce(O.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),o.flag?(r(),b(h,{key:0,placeholder:"请输入属性值",size:"small",modelValue:o.saleAttrValue,"onUpdate:modelValue":O=>o.saleAttrValue=O,ref_key:"EditComponent",ref:M,onBlur:O=>i(o)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(r(),b(T,{key:1,type:"primary",size:"small",style:{margin:"5px"},onClick:O=>S(o)},{default:t(()=>[e(Q,null,{default:t(()=>[e(G)]),_:1})]),_:2},1032,["onClick"]))]),_:1}),e(v,{prop:"prop",label:"操作"},{default:t(({$index:o})=>[e(T,{type:"danger",size:"small",style:{margin:"5px"},onClick:O=>l(s).splice(o,1)},{default:t(()=>[e(Q,null,{default:t(()=>[e(Ie)]),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(w,null,{default:t(()=>[e(T,{disabled:!l(s).length,type:"primary",onClick:C},{default:t(()=>a[7]||(a[7]=[Y("保存")])),_:1},8,["disabled"]),e(T,{onClick:V},{default:t(()=>a[8]||(a[8]=[Y("取消")])),_:1})]),_:1})]),_:1})}}}),at=["src"],nt=Z({name:"skuForm"}),ot=Z({...nt,emits:["changeScene"],setup(g,{expose:x,emit:A}){const U=c([]),V=c([]),E=c([]),k=c();let s=xe({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});async function D(N,d,m){s.category3Id=m.category3Id,s.spuId=m.id,s.tmId=m.tmId;const f=await qe(N,d,m.category3Id),I=await ke(m.id);let q=await Ve(m.id);U.value=f.data,V.value=I.data,E.value=q.data}function _(N){E.value.forEach(d=>d.isDefault=!1),N.isDefault=!0,k.value.clearSelection(N,!0),k.value.toggleRowSelection(N,!0),s.skuDefaultImg=N.imgUrl}const $=A;function R(){$("changeScene",{change:0,flag:"stay",rejectReq:!0})}async function y(){s.skuAttrValueList=U.value.reduce((d,m)=>{if(m.attrIdAndValueId){const[f,I]=m.attrIdAndValueId.split(":");d.push({attrId:f,valueId:I})}return d},[]),s.skuSaleAttrValueList=V.value.reduce((d,m)=>{if(m.saleIdAndValueId){const[f,I]=m.saleIdAndValueId.split(":");d.push({saleAttrId:f,saleAttrValueId:I})}return d},[]),(await We(s)).code===200?(H.success("添加SKU成功~"),$("changeScene",{change:0,flag:"stay",rejectReq:!0})):H.error("添加SKU失败~")}return x({initSkuData:D}),(N,d)=>{const m=be,f=ve,I=fe,q=ge,M=ye,S=se,i=re,C=de;return r(),b(M,{"label-width":"80px"},{default:t(()=>[e(f,{label:"SKU名称"},{default:t(()=>[e(m,{placeholder:"SKU名称",modelValue:l(s).skuName,"onUpdate:modelValue":d[0]||(d[0]=n=>l(s).skuName=n)},null,8,["modelValue"])]),_:1}),e(f,{label:"价格(元)"},{default:t(()=>[e(m,{placeholder:"价格(元)",type:"number",modelValue:l(s).price,"onUpdate:modelValue":d[1]||(d[1]=n=>l(s).price=n)},null,8,["modelValue"])]),_:1}),e(f,{label:"重量(克)"},{default:t(()=>[e(m,{placeholder:"重量(克)",type:"number",modelValue:l(s).weight,"onUpdate:modelValue":d[2]||(d[2]=n=>l(s).weight=n)},null,8,["modelValue"])]),_:1}),e(f,{label:"SKU描述"},{default:t(()=>[e(m,{type:"textarea",placeholder:"SKU描述",modelValue:l(s).skuDesc,"onUpdate:modelValue":d[3]||(d[3]=n=>l(s).skuDesc=n)},null,8,["modelValue"])]),_:1}),e(f,{label:"平台属性"},{default:t(()=>[e(M,{inline:!0,"label-width":"80px",class:"stageAttr"},{default:t(()=>[(r(!0),z(X,null,J(l(U),n=>(r(),b(f,{style:{margin:"0 10px 10px 0"},key:n.id,label:n.attrName},{default:t(()=>[e(q,{placeholder:"请选择",style:{width:"90px"},modelValue:n.attrIdAndValueId,"onUpdate:modelValue":p=>n.attrIdAndValueId=p},{default:t(()=>[(r(!0),z(X,null,J(n.attrValueList,p=>(r(),b(I,{key:p.id,label:p.valueName,value:`${n.id}:${p.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(f,{label:"销售属性"},{default:t(()=>[e(M,{inline:!0},{default:t(()=>[(r(!0),z(X,null,J(l(V),n=>(r(),b(f,{key:n.id,label:n.saleAttrName},{default:t(()=>[e(q,{placeholder:"请选择",style:{width:"90px"},modelValue:n.saleIdAndValueId,"onUpdate:modelValue":p=>n.saleIdAndValueId=p},{default:t(()=>[(r(!0),z(X,null,J(n.spuSaleAttrValueList,p=>(r(),b(I,{label:p.saleAttrValueName,value:`${n.id}:${p.id}`},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(f,{label:"图片名称"},{default:t(()=>[e(C,{style:{width:"100%"},border:"",data:l(E),ref_key:"table",ref:k},{default:t(()=>[e(S,{type:"selection",width:"width",align:"center"}),e(S,{prop:"prop",label:"图片",width:"width"},{default:t(({row:n})=>[j("img",{src:l(le)(n.imgUrl),alt:"",style:{width:"100px"}},null,8,at)]),_:1}),e(S,{prop:"imgName",label:"名称",width:"width"}),e(S,{label:"操作",width:"width"},{default:t(({row:n})=>[e(i,{type:"primary",size:"small",onClick:p=>_(n),plain:n.isDefault},{default:t(()=>[Y(ce(n.isDefault?"默认":"设置默认"),1)]),_:2},1032,["onClick","plain"])]),_:1})]),_:1},8,["data"])]),_:1}),e(f,{label:""},{default:t(()=>[e(i,{type:"primary",onClick:y},{default:t(()=>d[4]||(d[4]=[Y("保存")])),_:1}),e(i,{onClick:R},{default:t(()=>d[5]||(d[5]=[Y("取消")])),_:1})]),_:1})]),_:1})}}}),ut=Ae(ot,[["__scopeId","data-v-3b5be7a9"]]),st={class:"container"},dt={class:"card-content"},rt=["src"],it=Z({name:"Spu"}),pt=Z({...it,setup(g){const x=$e(),A=c(0),U=Me(),V=c(1),E=c(3),k=c([]),s=c(0),D=c(),_=c(),$=c([]),R=c(!1);async function y(S=1,i){if(V.value=S,!i&&U.c3Id){const C=await Je(V.value,E.value,U.c3Id);C.code===200&&(k.value=C.data.records,s.value=C.data.total)}}function N(){y()}function d(S){const{change:i,flag:C,rejectReq:n}=S;A.value=i,y(C==="stay"?V.value:1,n)}function m(){A.value=1,D.value.initAddSpu(U.c3Id)}function f(S){A.value=1,D.value.initHasSpuData(S)}function I(S){A.value=2,_.value.initSkuData(U.c1Id,U.c2Id,S)}async function q(S){const i=await Ye(S.id);i.code===200&&($.value=i.data,R.value=!0)}async function M(S){(await Ze(S.id)).code===200?(H.success("删除成功~"),await y(k.value.length>1?V.value:V.value-1)):H.error("删除失败~")}return(S,i)=>{const C=Be,n=ue,p=me,u=re,a=se,h=ze,w=Xe,B=Se,K=Re,te=de,Q=De,ae=_e,ne=Pe,G=Le("hasButton");return r(),z("div",st,[e(C,{scene:l(A),onEmitCategory:y},null,8,["scene"]),e(ne,null,{default:t(()=>{var T;return[F(j("div",dt,[(T=l(x).$state.userInfo.buttons)!=null&&T.includes("btn.Spu.add")?(r(),b(u,{key:0,type:"primary",disabled:!l(U).c3Id,onClick:m},{default:t(()=>[e(p,null,{default:t(()=>[e(n)]),_:1}),i[3]||(i[3]=j("span",null,"添加SPU",-1))]),_:1},8,["disabled"])):F((r(),b(u,{key:1,type:"primary"},{default:t(()=>[e(p,null,{default:t(()=>[e(n)]),_:1}),i[4]||(i[4]=j("span",null,"添加SPU",-1))]),_:1})),[[G,"btn.Spu.add:添加SPU"]]),e(te,{border:"",style:{width:"100%"},data:l(k)},{default:t(()=>[e(a,{type:"index",label:"序号",width:"80",align:"center"}),e(a,{prop:"spuName",label:"SPU名称",width:"width"}),e(a,{prop:"description",label:"SPU描述",width:"width","show-overflow-tooltip":""}),e(a,{prop:"index",label:"操作",width:"width"},{default:t(({row:v})=>[F((r(),b(u,{type:"primary",size:"small",title:"添加SKU",onClick:ee=>I(v),style:{margin:"5px"}},{default:t(()=>[e(p,null,{default:t(()=>[e(n)]),_:1})]),_:2},1032,["onClick"])),[[G,"btn.Spu.addsku:添加SKU"]]),F((r(),b(u,{type:"success",size:"small",title:"修改SKU",onClick:ee=>f(v),style:{margin:"5px"}},{default:t(()=>[e(p,null,{default:t(()=>[e(h)]),_:1})]),_:2},1032,["onClick"])),[[G,"btn.Spu.update:修改SKU"]]),F((r(),b(u,{type:"info",size:"small",title:"查看SKU",onClick:ee=>q(v),style:{margin:"5px"}},{default:t(()=>[e(p,null,{default:t(()=>[e(w)]),_:1})]),_:2},1032,["onClick"])),[[G,"btn.Spu.skus:查看SKU"]]),e(K,{title:`你确定要删除${v.spuName}么?`,onConfirm:ee=>M(v)},{reference:t(()=>[F((r(),b(u,{type:"danger",size:"small",title:"删除SKU",style:{margin:"5px"}},{default:t(()=>[e(p,null,{default:t(()=>[e(B)]),_:1})]),_:1})),[[G,"btn.Spu.delete:删除SKU"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(Q,{"current-page":l(V),"onUpdate:currentPage":i[0]||(i[0]=v=>W(V)?V.value=v:null),"page-size":l(E),"onUpdate:pageSize":i[1]||(i[1]=v=>W(E)?E.value=v:null),"page-sizes":[3,5,10],size:"small",background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:l(s),onCurrentChange:y,onSizeChange:N},null,8,["current-page","page-size","total"])],512),[[oe,l(A)===0]]),F(e(lt,{ref_key:"Spu",ref:D,onChangeScene:d},null,512),[[oe,l(A)===1]]),F(e(ut,{ref_key:"Sku",ref:_,onChangeScene:d},null,512),[[oe,l(A)===2]]),e(ae,{title:"SKU列表",modelValue:l(R),"onUpdate:modelValue":i[2]||(i[2]=v=>W(R)?R.value=v:null),style:{width:"80%"}},{default:t(()=>[e(te,{data:l($),style:{width:"100%"}},{default:t(()=>[e(a,{prop:"skuName",label:"SKU名字",width:"width"}),e(a,{prop:"price",label:"SKU价格",width:"width"}),e(a,{prop:"weight",label:"SKU重量",width:"width"}),e(a,{label:"SKU图片",width:"width"},{default:t(({row:v})=>[j("img",{src:l(le)(v.skuDefaultImg),alt:"",style:{width:"100px"}},null,8,rt)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]}),_:1})])}}}),$t=Ae(pt,[["__scopeId","data-v-8eb5fea4"]]);export{$t as default};

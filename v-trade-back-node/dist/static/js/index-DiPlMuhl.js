import{d as O,b as H,r as I,e as K,at as Q,o as u,c as L,f as e,g as s,w as a,a5 as b,h as r,A as v,Y as W,am as X,i as E,t as $,a6 as U,R as h,E as y,C as Z}from"./index-zCZRYDTo.js";import{E as tt}from"./el-card-BkJPws7M.js";import{E as et,a as at}from"./el-form-item-ndx7fGQi.js";/* empty css                 */import{E as lt,a as nt,b as ot}from"./el-table-column-YrvKGUHw.js";import"./el-popover-_8Ap7mUU.js";import{E as st}from"./el-button-feFDLJ41.js";import{u as rt,r as it,a as dt,b as ut,_ as pt}from"./index-C_hBPV_7.js";import{E as mt}from"./el-select-CQH5Taqg.js";import{E as ct}from"./index-DlRGIAZ6.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _t={class:"container"},vt={class:"card-content"},yt={class:"card-content"},bt=["onClick"],gt=O({name:"Attr"}),Et=O({...gt,setup(Ct){const m=rt(),T=H(),C=I([]),c=I(0),l=K({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),V=I();async function N(){if(m.c1Id){C.value=[];const o=await it(m.c1Id,m.c2Id,m.c3Id);o.code===200&&(C.value=o.data)}}function z(){l.attrValueList.push({valueName:"",isEdit:!0}),h(()=>{V.value.focus()})}function q(){Object.assign(l,{attrName:"",attrValueList:[],categoryId:m.c3Id,categoryLevel:3,id:void 0}),c.value=1,l.categoryId=m.c3Id}function D(o){c.value=1,Object.assign(l,JSON.parse(JSON.stringify(o)))}function A(){c.value=0}async function F(o,t){const _=await dt(o);(_==null?void 0:_.code)===200?(y.success(`删除${t}属性成功~`),N()):y.error(`删除${t}属性失败~`)}async function j(){(await ut(l)).code===200?(c.value=0,y.success(l.id?"修改成功~":"添加成功~"),N()):y.error(l.id?"修改失败~":"添加失败~")}function J(o,t){if(o.valueName.trim()===""){l.attrValueList.splice(t,1),y.error("属性值不能为空~");return}if(l.attrValueList.find(i=>{if(i!==o)return i.valueName===o.valueName})){l.attrValueList.splice(t,1),y.error("属性值不能重复~");return}o.isEdit=!1}function P(o){o.isEdit=!0,h(()=>{V.value.focus()})}return(o,t)=>{const _=pt,i=Z,d=st,f=lt,R=mt,w=nt,x=ot,B=ct,M=et,Y=at,G=tt,k=Q("hasButton");return u(),L("div",_t,[e(_,{onEmitCategory:N,scene:s(c)},null,8,["scene"]),e(G,{class:"attr-card"},{default:a(()=>{var S;return[b(r("div",vt,[(S=s(T).$state.userInfo.buttons)!=null&&S.includes("btn.Attr.add")?(u(),v(d,{key:0,type:"primary",disabled:!s(m).c3Id,onClick:q},{default:a(()=>[e(i,null,{default:a(()=>t[1]||(t[1]=[r("i",{class:"i-ep-plus"},null,-1)])),_:1}),t[2]||(t[2]=r("span",null,"添加平台属性",-1))]),_:1},8,["disabled"])):b((u(),v(d,{key:1,type:"primary"},{default:a(()=>[e(i,null,{default:a(()=>t[3]||(t[3]=[r("i",{class:"i-ep-plus"},null,-1)])),_:1}),t[4]||(t[4]=r("span",null,"添加平台属性",-1))]),_:1})),[[k,"btn.Attr.add:添加平台属性"]]),e(x,{style:{width:"100%"},border:"",data:s(C)},{default:a(()=>[e(f,{type:"index",prop:"prop",label:"序号",width:"80",align:"center"}),e(f,{prop:"attrName",label:"属性名称",width:"width"}),e(f,{label:"属性值名称",width:"width"},{default:a(({row:n})=>[(u(!0),L(W,null,X(n.attrValueList,p=>(u(),v(R,{key:p.attrId,style:{margin:"5px"}},{default:a(()=>[E($(p.valueName),1)]),_:2},1024))),128))]),_:1}),e(f,{prop:"prop",label:"操作",width:"width"},{default:a(({row:n})=>[b((u(),v(d,{type:"warning",size:"small",onClick:p=>D(n)},{default:a(()=>[e(i,null,{default:a(()=>t[5]||(t[5]=[r("i",{class:"i-ep-edit"},null,-1)])),_:1})]),_:2},1032,["onClick"])),[[k,"btn.Attr.update:编辑平台属性"]]),e(w,{title:`你确定要删除${n.attrName}么?`,onConfirm:p=>F(n.id,n.attrName)},{reference:a(()=>[b((u(),v(d,{type:"danger",size:"small"},{default:a(()=>[e(i,null,{default:a(()=>t[6]||(t[6]=[r("i",{class:"i-ep-delete"},null,-1)])),_:1})]),_:1})),[[k,"btn.Attr.remove:删除平台属性"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[U,s(c)===0]]),b(r("div",yt,[e(Y,{inline:!0},{default:a(()=>[e(M,{label:"属性名称"},{default:a(()=>[e(B,{placeholder:"请输入属性名称",modelValue:s(l).attrName,"onUpdate:modelValue":t[0]||(t[0]=n=>s(l).attrName=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{type:"primary",disabled:!s(l).attrName,onClick:z},{default:a(()=>[e(i,null,{default:a(()=>t[7]||(t[7]=[r("i",{class:"i-ep-plus"},null,-1)])),_:1}),t[8]||(t[8]=r("span",null,"添加属性值",-1))]),_:1},8,["disabled"]),e(d,{onClick:A},{default:a(()=>t[9]||(t[9]=[E("取消")])),_:1}),e(x,{style:{width:"100%"},border:"",data:s(l).attrValueList},{default:a(()=>[e(f,{prop:"prop",label:"序号",type:"index",width:"80",align:"center"}),e(f,{prop:"prop",label:"属性值",width:"width"},{default:a(({row:n,$index:p})=>[n.isEdit?(u(),v(B,{key:0,placeholder:"请输入属性值名称",modelValue:n.valueName,"onUpdate:modelValue":g=>n.valueName=g,onBlur:g=>J(n,p),size:"small",ref_key:"EditComponent",ref:V},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(u(),L("div",{key:1,onClick:g=>P(n)},$(n.valueName),9,bt))]),_:1}),e(f,{prop:"prop",label:"操作",width:"width"},{default:a(({$index:n,row:p})=>[e(w,{title:`你确定要删除${p.valueName}么？`,onConfirm:g=>s(l).attrValueList.splice(n,1)},{reference:a(()=>[e(d,{type:"danger",size:"small"},{default:a(()=>[e(i,null,{default:a(()=>t[10]||(t[10]=[r("i",{class:"i-ep-delete"},null,-1)])),_:1})]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(d,{type:"primary",onClick:j,disabled:!(s(l).attrValueList.length>0&&s(l).attrValueList[s(l).attrValueList.length-1].valueName.trim()!=="")},{default:a(()=>t[11]||(t[11]=[E("保存")])),_:1},8,["disabled"]),e(d,{onClick:A},{default:a(()=>t[12]||(t[12]=[E("取消")])),_:1})],512),[[U,s(c)===1]])]}),_:1})])}}}),Ut=ft(Et,[["__scopeId","data-v-04e4f45e"]]);export{Ut as default};

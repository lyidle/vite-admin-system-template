import{ay as h,az as E,a as Q,ar as ke,N as ye,r as i,O as _e,aw as be,aA as Ue,f as p,s as J,y as l,k as o,au as U,w as t,h as A,g as w,P as k,j as C,p as Ce,F as he,as as Ee,t as Ve,a5 as xe,av as y,E as Ne}from"./index-C-Hr_Kst.js";import{E as Re}from"./el-card-BIvMogWJ.js";import{E as Se,a as Ae,b as ze,c as Ie,e as Te}from"./el-table-column-BWkg-oUL.js";import{E as qe}from"./el-drawer-DHpjpQyr.js";import"./el-overlay-CBSgNWnW.js";import{E as $e,a as Be}from"./el-form-item-D5nk7iP3.js";/* empty css                 */import{E as He}from"./el-pagination-DGXCxo0C.js";import"./el-select-BXzTZbgG.js";import"./el-popover-C7y7ELvv.js";import{E as Pe}from"./el-button-CCBhb979.js";import{u as Fe,_ as Le}from"./usereqUserInfo-DN--d3Yw.js";import{E as je}from"./index-BcM80TaK.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vnode-Djh7ukKe.js";const Me=(u,z,P)=>h.get(E.AUTH+`/admin/acl/user/${u}/${z}/?username=${P}`),Oe=u=>u.id?h.put(E.AUTH+"/admin/acl/user/update",u):h.post(E.AUTH+"/admin/acl/user/save",u),Ge=u=>h.get(E.AUTH+"/admin/acl/user/toAssign/"+u),Ke=u=>h.post(E.AUTH+"/admin/acl/user/doAssignRole",u),Xe=u=>h.delete(E.AUTH+"/admin/acl/user/remove/"+u),Je=u=>h.delete(E.AUTH+"/admin/acl/user/batchRemove",{data:u}),Qe={class:"container"},We={class:"singe-line-elipsis",style:{width:"50px"}},Ye=Q({name:"User"}),Ze=Q({...Ye,setup(u){const z=ke(),P=ye(),m=i(1),I=i(5),D=i(0),T=i([]),f=i(!1),_=i(!1),x=i("I am the title"),s=_e({username:void 0,nickName:void 0,password:void 0}),q=i(!1),$=i(!1),b=i([]),V=i([]),v=i([]),F=i(),L=i(""),N=i("");function W(a,e,r){e.trim().length>=1?r():r(new Error("用户名字至少一位~"))}function Y(a,e,r){e.trim().length>=1?r():r(new Error("用户昵称至少一位~"))}function Z(a,e,r){e.trim().length>=6?r():r(new Error("用户密码至少六位~"))}const ee={username:[{required:!0,trigger:"change",validator:W}],nickName:[{required:!0,trigger:"change",validator:Y}],password:[{required:!0,trigger:"change",validator:Z}]};async function g(a=1){m.value=a;const e=await Me(m.value,I.value,L.value);e.code===2e4&&(D.value=e.data.total,T.value=e.data.items)}async function le(){f.value=!0,x.value="添加用户"}async function te(a){f.value=!0,x.value="编辑用户",xe(()=>{Object.assign(s,{id:a.id,username:a.username,nickName:a.nickName})})}async function ae(){await F.value.validate(),(await Oe(s)).code===2e4?(Fe(()=>{g(s.id?m.value:1)}),f.value=!1,y.success(s.id?"更新成功~":"添加成功~")):(f.value=!1,y.success(s.id?"更新失败~":"添加失败~"))}async function ne(a){Object.assign(s,{id:a.id,username:a.username,nickName:a.nickName});const e=await Ge(s.id);if(e.code===2e4){V.value=e.data.allRolesList,b.value=e.data.assignRoles;const r=b.value.length;$.value=r>0&&r<V.value.length,_.value=!0,x.value="分配角色"}}const oe=a=>{b.value=a?V.value:[],$.value=!1},se=a=>{const e=a.length;q.value=e===V.value.length,$.value=e>0&&e<V.value.length};async function re(){let a={userId:s.id,roleIdList:b.value.map(r=>r.id)};(await Ke(a)).code===2e4?(y.success("分配职务成功~"),_.value=!1,g(m.value)):(y.error("分配职务失败~"),_.value=!1)}async function ie(a){(await Xe(a)).code===2e4?(y.success("删除成功~"),g(T.value.length>1?m.value:m.value-1)):y.error("删除失败~")}function ue(a){v.value=a}async function de(){const a=v.value.map(d=>d.id),e=await Je(a);let r=m.value;v.value.length>=T.value.length&&(r=m.value-1),e.code===2e4?(y.success("批量删除成功~"),g(r)):y.error("批量删除失败~")}function me(){L.value=N.value,g(),L.value="",N.value=""}function pe(){z.windowRefresh=!z.windowRefresh}function M(){var a;(a=F.value)==null||a.resetFields(),s.id=void 0,s.password=void 0}return be(()=>{g()}),(a,e)=>{const r=Le,d=Pe,c=Se,j=Ne,ce=Ae,fe=ze,ve=He,B=je,R=$e,O=Be,G=qe,K=Ie,ge=Te,we=Re,S=Ue("hasButton");return p(),J("div",Qe,[l(r,{keyword:o(N),"onUpdate:keyword":e[0]||(e[0]=H=>U(N)?N.value=H:null),onSearch:me,onReset:pe},null,8,["keyword"]),l(we,null,{default:t(()=>{var H;return[A((p(),w(d,{type:"primary",onClick:le},{default:t(()=>e[13]||(e[13]=[k("添加用户")])),_:1})),[[S,"btn.User.add:添加用户"]]),(H=o(P).$state.userInfo.buttons)!=null&&H.includes("btn.User.remove")?(p(),w(d,{key:0,type:o(v).length?"danger":"primary",plain:!o(v).length,onClick:de,disabled:!o(v).length},{default:t(()=>e[14]||(e[14]=[k("批量删除")])),_:1},8,["type","plain","disabled"])):A((p(),w(d,{key:1,type:o(v).length?"danger":"primary",plain:!o(v).length},{default:t(()=>e[15]||(e[15]=[k("批量删除")])),_:1},8,["type","plain"])),[[S,"btn.User.remove:批量删除用户"]]),l(fe,{style:{width:"100%","margin-top":"10px"},border:"",data:o(T),onSelectionChange:ue},{default:t(()=>[l(c,{type:"selection","min-width":"40",align:"center"}),l(c,{type:"index",label:"#","min-width":"40",align:"center"}),l(c,{prop:"id",label:"id","min-width":"100","show-overflow-tooltip":"",align:"center"}),l(c,{prop:"username",label:"用户名字","min-width":"100","show-overflow-tooltip":"",align:"center"}),l(c,{prop:"nickName",label:"用户名称","min-width":"100","show-overflow-tooltip":"",align:"center"}),l(c,{prop:"roleName",label:"用户角色","min-width":"100","show-overflow-tooltip":"",align:"center"}),l(c,{prop:"gmtCreate",label:"创建时间","min-width":"200",align:"center"}),l(c,{prop:"gmtModified",label:"更新时间","min-width":"200",align:"center"}),l(c,{width:"300",label:"操作",align:"center",fixed:"right"},{default:t(({row:n})=>[A((p(),w(d,{type:"primary",size:"small",onClick:X=>ne(n)},{default:t(()=>[l(j,null,{default:t(()=>e[16]||(e[16]=[C("i",{class:"i-ep-user"},null,-1)])),_:1}),e[17]||(e[17]=C("span",null,"分配角色",-1))]),_:2},1032,["onClick"])),[[S,"btn.User.assgin:对用户分配角色"]]),A((p(),w(d,{type:"warning",size:"small",onClick:X=>te(n)},{default:t(()=>[l(j,null,{default:t(()=>e[18]||(e[18]=[C("i",{class:"i-ep-edit"},null,-1)])),_:1}),e[19]||(e[19]=C("span",null,"编辑",-1))]),_:2},1032,["onClick"])),[[S,"btn.User.update:编辑用户"]]),l(ce,{title:`你确定要删除${n.username}么?`,width:"260px",onConfirm:X=>ie(n.id)},{reference:t(()=>[A((p(),w(d,{type:"danger",size:"small"},{default:t(()=>[l(j,null,{default:t(()=>e[20]||(e[20]=[C("i",{class:"i-ep-delete"},null,-1)])),_:1}),e[21]||(e[21]=C("span",null,"删除",-1))]),_:1})),[[S,"btn.User.remove:删除用户"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(ve,{"current-page":o(m),"onUpdate:currentPage":e[1]||(e[1]=n=>U(m)?m.value=n:null),"page-size":o(I),"onUpdate:pageSize":e[2]||(e[2]=n=>U(I)?I.value=n:null),"page-sizes":[3,5,10],size:"small",background:!0,layout:" prev, pager, next, jumper,->,sizes,total",total:o(D),onSizeChange:e[3]||(e[3]=n=>g()),onCurrentChange:g,style:{"margin-top":"10px"}},null,8,["current-page","page-size","total"]),l(G,{modelValue:o(f),"onUpdate:modelValue":e[8]||(e[8]=n=>U(f)?f.value=n:null),title:o(x),style:{"max-width":"500px"},size:"100%",onClosed:M},{footer:t(()=>[l(d,{type:"primary",onClick:ae},{default:t(()=>e[22]||(e[22]=[k("确定")])),_:1}),l(d,{onClick:e[7]||(e[7]=n=>f.value=!1)},{default:t(()=>e[23]||(e[23]=[k("取消")])),_:1})]),default:t(()=>[l(O,{"label-width":"80px",model:o(s),rules:ee,ref_key:"formRef",ref:F},{default:t(()=>[l(R,{label:"用户姓名",prop:"username"},{default:t(()=>[l(B,{placeholder:"请填写用户名字",modelValue:o(s).username,"onUpdate:modelValue":e[4]||(e[4]=n=>o(s).username=n)},null,8,["modelValue"])]),_:1}),l(R,{label:"用户昵称",prop:"nickName"},{default:t(()=>[l(B,{placeholder:"请填写用户昵称",modelValue:o(s).nickName,"onUpdate:modelValue":e[5]||(e[5]=n=>o(s).nickName=n)},null,8,["modelValue"])]),_:1}),o(s).id?Ce("",!0):(p(),w(R,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(B,{placeholder:"请填写用户密码",modelValue:o(s).password,"onUpdate:modelValue":e[6]||(e[6]=n=>o(s).password=n)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(G,{modelValue:o(_),"onUpdate:modelValue":e[12]||(e[12]=n=>U(_)?_.value=n:null),title:o(x),style:{"max-width":"500px"},size:"100%",onClosed:M},{footer:t(()=>[l(d,{type:"primary",onClick:re},{default:t(()=>e[25]||(e[25]=[k("确定")])),_:1}),l(d,{onClick:e[11]||(e[11]=n=>_.value=!1)},{default:t(()=>e[26]||(e[26]=[k("取消")])),_:1})]),default:t(()=>[l(O,{"label-width":"80px"},{default:t(()=>[l(R,{label:"用户姓名"},{default:t(()=>[l(B,{disabled:"",placeholder:o(s).username},null,8,["placeholder"])]),_:1}),l(R,{label:"职位列表"},{default:t(()=>[l(K,{modelValue:o(q),"onUpdate:modelValue":e[9]||(e[9]=n=>U(q)?q.value=n:null),indeterminate:o($),onChange:oe},{default:t(()=>e[24]||(e[24]=[k(" Check all ")])),_:1},8,["modelValue","indeterminate"]),l(ge,{modelValue:o(b),"onUpdate:modelValue":e[10]||(e[10]=n=>U(b)?b.value=n:null),onChange:se},{default:t(()=>[(p(!0),J(he,null,Ee(o(V),n=>(p(),w(K,{key:n.id,value:n},{default:t(()=>[C("div",We,Ve(n.roleName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])]}),_:1})])}}}),vl=De(Ze,[["__scopeId","data-v-fcde76c5"]]);export{vl as default};

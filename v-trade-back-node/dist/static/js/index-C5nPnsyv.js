import{a as T,N as X,r as I,O as Y,aB as Z,f as i,s as L,y as t,k as s,w as e,h as b,j as g,g as v,F as tt,as as et,P as E,t as $,v as O,a5 as U,aw as y,E as at}from"./index-DpaPK14g.js";import{E as lt}from"./el-card-jy9cJqIZ.js";import{E as nt,a as ot}from"./el-form-item-Utq6rYWC.js";/* empty css                 */import{E as st,a as rt,b as it}from"./el-table-column-Om27YJSB.js";import"./el-popover-B0UGxlQI.js";import{E as dt}from"./el-button-C3BECGQo.js";import{E as ut,_ as ct,a as pt}from"./edit-C5rcNmWR.js";import{_ as _t}from"./plus-Bqin_PZf.js";import{u as mt,r as ft,a as vt,b as yt,_ as bt}from"./index-BaNNlmEo.js";import{E as gt}from"./index-CKDBud7m.js";import{_ as Et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ct={class:"container"},Vt={class:"card-content"},kt={class:"card-content"},Nt=["onClick"],ht=T({name:"Attr"}),It=T({...ht,setup(Lt){const d=mt(),z=X(),C=I([]),u=I(0),l=Y({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),V=I();async function k(){if(d.c1Id){C.value=[];const o=await ft(d.c1Id,d.c2Id,d.c3Id);o.code===200&&(C.value=o.data)}}function D(){l.attrValueList.push({valueName:"",isEdit:!0}),U(()=>{V.value.focus()})}function F(){Object.assign(l,{attrName:"",attrValueList:[],categoryId:d.c3Id,categoryLevel:3,id:void 0}),u.value=1,l.categoryId=d.c3Id}function P(o){u.value=1,Object.assign(l,JSON.parse(JSON.stringify(o)))}function w(){u.value=0}async function j(o,a){const _=await vt(o);(_==null?void 0:_.code)===200?(y.success(`删除${a}属性成功~`),k()):y.error(`删除${a}属性失败~`)}async function q(){(await yt(l)).code===200?(u.value=0,y.success(l.id?"修改成功~":"添加成功~"),k()):y.error(l.id?"修改失败~":"添加失败~")}function J(o,a){if(o.valueName.trim()===""){l.attrValueList.splice(a,1),y.error("属性值不能为空~");return}if(l.attrValueList.find(m=>{if(m!==o)return m.valueName===o.valueName})){l.attrValueList.splice(a,1),y.error("属性值不能重复~");return}o.isEdit=!1}function M(o){o.isEdit=!0,U(()=>{V.value.focus()})}return(o,a)=>{const _=bt,m=_t,f=at,r=dt,c=st,R=ut,G=ct,A=pt,H=rt,B=it,x=gt,K=nt,Q=ot,W=lt,N=Z("hasButton");return i(),L("div",Ct,[t(_,{onEmitCategory:k,scene:s(u)},null,8,["scene"]),t(W,{class:"attr-card"},{default:e(()=>{var S;return[b(g("div",Vt,[(S=s(z).$state.userInfo.buttons)!=null&&S.includes("btn.Attr.add")?(i(),v(r,{key:0,type:"primary",disabled:!s(d).c3Id,onClick:F},{default:e(()=>[t(f,null,{default:e(()=>[t(m)]),_:1}),a[1]||(a[1]=g("span",null,"添加平台属性",-1))]),_:1},8,["disabled"])):b((i(),v(r,{key:1,type:"primary"},{default:e(()=>[t(f,null,{default:e(()=>[t(m)]),_:1}),a[2]||(a[2]=g("span",null,"添加平台属性",-1))]),_:1})),[[N,"btn.Attr.add:添加平台属性"]]),t(B,{style:{width:"100%"},border:"",data:s(C)},{default:e(()=>[t(c,{type:"index",prop:"prop",label:"序号",width:"80",align:"center"}),t(c,{prop:"attrName",label:"属性名称",width:"width"}),t(c,{label:"属性值名称",width:"width"},{default:e(({row:n})=>[(i(!0),L(tt,null,et(n.attrValueList,p=>(i(),v(R,{key:p.attrId,style:{margin:"5px"}},{default:e(()=>[E($(p.valueName),1)]),_:2},1024))),128))]),_:1}),t(c,{prop:"prop",label:"操作",width:"width"},{default:e(({row:n})=>[b((i(),v(r,{type:"warning",size:"small",onClick:p=>P(n)},{default:e(()=>[t(f,null,{default:e(()=>[t(G)]),_:1})]),_:2},1032,["onClick"])),[[N,"btn.Attr.update:编辑平台属性"]]),t(H,{title:`你确定要删除${n.attrName}么?`,onConfirm:p=>j(n.id,n.attrName)},{reference:e(()=>[b((i(),v(r,{type:"danger",size:"small"},{default:e(()=>[t(f,null,{default:e(()=>[t(A)]),_:1})]),_:1})),[[N,"btn.Attr.remove:删除平台属性"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[O,s(u)===0]]),b(g("div",kt,[t(Q,{inline:!0},{default:e(()=>[t(K,{label:"属性名称"},{default:e(()=>[t(x,{placeholder:"请输入属性名称",modelValue:s(l).attrName,"onUpdate:modelValue":a[0]||(a[0]=n=>s(l).attrName=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{type:"primary",disabled:!s(l).attrName,onClick:D},{default:e(()=>[t(f,null,{default:e(()=>[t(m)]),_:1}),a[3]||(a[3]=g("span",null,"添加属性值",-1))]),_:1},8,["disabled"]),t(r,{onClick:w},{default:e(()=>a[4]||(a[4]=[E("取消")])),_:1}),t(B,{style:{width:"100%"},border:"",data:s(l).attrValueList},{default:e(()=>[t(c,{prop:"prop",label:"序号",type:"index",width:"80",align:"center"}),t(c,{prop:"prop",label:"属性值",width:"width"},{default:e(({row:n,$index:p})=>[n.isEdit?(i(),v(x,{key:0,placeholder:"请输入属性值名称",modelValue:n.valueName,"onUpdate:modelValue":h=>n.valueName=h,onBlur:h=>J(n,p),size:"small",ref_key:"EditComponent",ref:V},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(i(),L("div",{key:1,onClick:h=>M(n)},$(n.valueName),9,Nt))]),_:1}),t(c,{prop:"prop",label:"操作",width:"width"},{default:e(({$index:n})=>[t(r,{type:"danger",onClick:p=>s(l).attrValueList.splice(n,1),size:"small"},{default:e(()=>[t(f,null,{default:e(()=>[t(A)]),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(r,{type:"primary",onClick:q,disabled:!(s(l).attrValueList.length>0&&s(l).attrValueList[s(l).attrValueList.length-1].valueName.trim()!=="")},{default:e(()=>a[5]||(a[5]=[E("保存")])),_:1},8,["disabled"]),t(r,{onClick:w},{default:e(()=>a[6]||(a[6]=[E("取消")])),_:1})],512),[[O,s(u)===1]])]}),_:1})])}}}),Pt=Et(It,[["__scopeId","data-v-2c749034"]]);export{Pt as default};

import{ar as _,as as b,d as B,b as S,r as P,e as j,ap as N,at as X,o as m,c as G,f as a,w as s,g as n,A as p,i as r,t as $,a5 as C,ao as J,E as y}from"./index-zCZRYDTo.js";import{E as K}from"./el-dialog-DaNoymXH.js";import"./el-overlay-DpAhsVqO.js";import{E as L,a as Q}from"./el-form-item-ndx7fGQi.js";/* empty css                 */import{E as W,a as Y,b as Z}from"./el-table-column-YrvKGUHw.js";import"./el-popover-_8Ap7mUU.js";import{E as h}from"./el-button-feFDLJ41.js";import{E as w}from"./index-DlRGIAZ6.js";import"./refs-cuhhTPoP.js";import"./vnode-Dy4NM1xu.js";const ee=()=>_.get(b.AUTH+"/admin/acl/permission"),le=u=>u.id?_.put(b.AUTH+"/admin/acl/permission/update",u):_.post(b.AUTH+"/admin/acl/permission/save",u),te=u=>_.delete(b.AUTH+"/admin/acl/permission/remove/"+u),se=B({name:"Permission"}),ce=B({...se,setup(u){const g=S(),V=P([]),o=P(!1),f=P("Tips"),i=j({code:void 0,level:void 0,name:void 0,pid:void 0});async function E(){const t=await ee();t.code===2e4&&(V.value=t.data.children)}function z(t){o.value=!0,f.value=t.level>=3?"添加功能":"添加菜单",i.level=t.level+1,i.pid=t.id}function I(t){o.value=!0,f.value=t.level<=3?"编辑菜单":"编辑功能",Object.assign(i,{id:t.id,code:t.code,level:t.level,name:t.name,pid:t.pid})}async function D(){(await le(i)).code===2e4?(E(),o.value=!1,y.success(i.id?"更新成功~":"添加成功~")):(o.value=!1,y.error(i.id?"更新失败~":"添加失败~"))}async function H(t){(await te(t)).code===2e4?(E(),y.success("删除成功~")):(o.value=!1,y.error("删除失败~"))}function M(){f.value="",Object.assign(i,{id:void 0,code:void 0,level:void 0,name:void 0,pid:void 0})}return N(()=>{E()}),(t,l)=>{const c=W,d=h,q=Y,F=Z,x=w,U=L,O=Q,R=K,k=X("hasButton");return m(),G("div",null,[a(F,{data:n(V),style:{width:"100%","margin-bottom":"20px"},"row-key":"id",border:""},{default:s(()=>[a(c,{prop:"name",label:"名称"}),a(c,{prop:"code",label:"权限值"}),a(c,{prop:"gmtCreate",label:"修改时间"}),a(c,{label:"操作"},{default:s(({row:e})=>{var T,A;return[(T=n(g).$state.userInfo.buttons)!=null&&T.includes("btn.Permission.remove")?(m(),p(d,{key:0,type:e.level<=1?"default":e.level<=2?"success":(e.level<=3,"primary"),plain:!(e.level>=4),size:"small",style:{margin:"5px"},onClick:v=>z(e),disabled:e.level>=4},{default:s(()=>[r($(e.level>=3?"添加功能":"添加菜单"),1)]),_:2},1032,["type","plain","onClick","disabled"])):C((m(),p(d,{key:1,type:e.level<=1?"default":e.level<=2?"success":(e.level<=3,"primary"),plain:!(e.level>=4),size:"small",style:{margin:"5px"}},{default:s(()=>[r($(e.level>=3?"添加功能":"添加菜单"),1)]),_:2},1032,["type","plain"])),[[k,`btn.Permission.add:${e.level>=3?"添加功能":"添加菜单"}`]]),(A=n(g).$state.userInfo.buttons)!=null&&A.includes("btn.Permission.update")?(m(),p(d,{key:2,type:e.level<=1?"default":e.level<=2?"success":(e.level<=3,"primary"),plain:!(e.level>=4),size:"small",style:{margin:"5px"},onClick:v=>I(e),disabled:e.level==1},{default:s(()=>l[3]||(l[3]=[r("编辑")])),_:2},1032,["type","plain","onClick","disabled"])):C((m(),p(d,{key:3,type:e.level<=1?"default":e.level<=2?"success":(e.level<=3,"primary"),plain:!(e.level>=4),size:"small",style:{margin:"5px"}},{default:s(()=>l[4]||(l[4]=[r("编辑")])),_:2},1032,["type","plain"])),[[k,"btn.Permission.update:编辑菜单"]]),a(q,{title:`你确定要删除${e.name}么？`,width:"230",onConfirm:v=>H(e.id)},{reference:s(()=>{var v;return[(v=n(g).$state.userInfo.buttons)!=null&&v.includes("btn.Permission.remove")?(m(),p(d,{key:0,type:e.level<=1?"default":e.level<=2?"success":(e.level<=3,"primary"),plain:!(e.level>=4),size:"small",style:{margin:"5px"},disabled:e.level==1},{default:s(()=>l[5]||(l[5]=[r(" 删除 ")])),_:2},1032,["type","plain","disabled"])):C((m(),p(d,{key:1,type:e.level<=1?"default":e.level<=2?"success":(e.level<=3,"primary"),plain:!(e.level>=4),size:"small",style:{margin:"5px"}},{default:s(()=>l[6]||(l[6]=[r(" 删除 ")])),_:2},1032,["type","plain"])),[[k,"btn.Permission.remove:删除菜单"]])]}),_:2},1032,["title","onConfirm"])]}),_:1})]),_:1},8,["data"]),a(R,{modelValue:n(o),"onUpdate:modelValue":l[2]||(l[2]=e=>J(o)?o.value=e:null),title:n(f),width:"500",onClosed:M},{footer:s(()=>[a(d,null,{default:s(()=>l[7]||(l[7]=[r("取消")])),_:1}),a(d,{type:"primary",onClick:D},{default:s(()=>l[8]||(l[8]=[r("确定")])),_:1})]),default:s(()=>[a(O,{"label-width":"80"},{default:s(()=>[a(U,{label:"名称"},{default:s(()=>[a(x,{placeholder:"请输入菜单名称",modelValue:n(i).name,"onUpdate:modelValue":l[0]||(l[0]=e=>n(i).name=e)},null,8,["modelValue"])]),_:1}),a(U,{label:"权限值"},{default:s(()=>[a(x,{placeholder:"请输入权限数值",modelValue:n(i).code,"onUpdate:modelValue":l[1]||(l[1]=e=>n(i).code=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});export{ce as default};
